<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
        xmlns:camel="http://camel.apache.org/schema/blueprint" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0"
        xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
       http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd">
		<cm:property-placeholder id="producer" persistent-id="org.mrobson.example.amq.producer"/>
        <!--cm:property-placeholder id="org.mrobson.example.placeholders" persistent-id="org.mrobson.example.camel.route" placeholder-prefix="[[" placeholder-suffix="]]">>
                <cm:default-properties>
                        <cm:property name="hostname" value="fabric" />
                        <cm:property name="port" value="9000" />
                </cm:default-properties>
        </cm:property-placeholder-->

<camelContext trace="false" xmlns="http://camel.apache.org/schema/blueprint">
  <route id="produce-random-message1">
    <from uri="amq:queue:com.redhat.incoming"/>
    <to uri="amq:queue:com.redhat.service1?replyTo=com.redhat.service1.reply&amp;replyToType=Exclusive&amp;concurrentConsumers=5&amp;requestTimeout=35000" pattern="InOut" />
    <camel:onException>
	    <camel:exception>org.apache.camel.ExchangeTimedOutException</camel:exception>
	    <redeliveryPolicy maximumRedeliveries="1"/>
	    <handled>
	        <constant>true</constant>
	    </handled>
	    <transform>
	        <simple>Error reported: ${exception.message} - cannot process this message.</simple>
	    </transform>
    </camel:onException>
    <log message="${body}"/>
  </route>
  <route id="process-random-message1">
    <from uri="amq:queue:com.redhat.service1"/>
        <transform>
      <simple>Hello {{name}} how are you?</simple>
    </transform>
    <log message="${body}"/>
    <bean ref="myConsumer" method="validate"/>
  </route>
  <route id="send-random-message1">
    <from uri="timer://productionTimer?fixedRate=true&amp;period=1000"/>
    <bean ref="myProducer" method="produce"/>
    <to uri="amq:queue:com.redhat.incoming"/>
  </route>
</camelContext>
    <bean id="myProducer" class="org.mrobson.example.amq.producer.MyProducer"/>
    <bean id="myConsumer" class="org.mrobson.example.amq.producer.MyConsumer"/>
    <bean id="myProcessor" class="org.mrobson.example.amq.producer.MyProcessor"/>
</blueprint>